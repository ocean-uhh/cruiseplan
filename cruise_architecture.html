

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CruisePlan Architecture &mdash; CruisePlan v0.3.0 v0.3.0.post1.dev1</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=393fce2e" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=a448664d"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CLI Command Reference" href="cli_reference.html" />
    <link rel="prev" title="CruisePlan Demo" href="demo-output.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CruisePlan v0.3.0
              <img src="_static/cruise_plan_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CLI Workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="user_workflows.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_workflows.html#workflow-paths">Workflow Paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_workflows.html#advanced-topics">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_workflows.html#troubleshooting">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Notebook Demo</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="demo-output.html">CruisePlan Demo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Specifications</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cruise Specifications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hierarchical-grouping-system">Hierarchical Grouping System</a></li>
<li class="toctree-l2"><a class="reference internal" href="#design-principles">Design Principles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hierarchical-organization">1. Hierarchical Organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#activities-only-architecture">2. Activities-Only Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parameter-inheritance">3. Parameter Inheritance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cluster-boundaries">4. Cluster Boundaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#default-behavior">5. Default Behavior</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#data-models">Data Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#legdefinition-yaml-configuration">LegDefinition (YAML Configuration)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clusterdefinition-yaml-configuration">ClusterDefinition (YAML Configuration)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#portdefinition-yaml-configuration">PortDefinition (YAML Configuration)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#runtime-objects">Runtime Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#leg-class">Leg Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cluster-class">Cluster Class</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#port-system">Port System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#global-port-registry">Global Port Registry</a></li>
<li class="toctree-l3"><a class="reference internal" href="#port-resolution">Port Resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#port-expansion">Port Expansion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#scheduling-logic">Scheduling Logic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#port-to-port-routing">Port-to-Port Routing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Parameter Inheritance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cluster-processing">Cluster Processing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-examples">Configuration Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-single-leg-cruise-auto-created-leg">Simple Single-Leg Cruise (Auto-Created Leg)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#explicit-single-leg-cruise">Explicit Single-Leg Cruise</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multi-leg-expedition">Multi-Leg Expedition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-cluster-organization">Advanced Cluster Organization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#development-guidelines">Development Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-new-ports">Adding New Ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extending-operation-types">Extending Operation Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-scheduling-strategies">Custom Scheduling Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#entry-exit-point-abstraction">Entry/Exit Point Abstraction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#migration-from-legacy-architecture">Migration from Legacy Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#deprecated-fields">Deprecated Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#migration-strategy">Migration Strategy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#backward-compatibility">Backward Compatibility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#architecture-benefits">Architecture Benefits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#memory-usage">Memory Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scheduling-performance">Scheduling Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#large-expeditions">Large Expeditions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html">CLI Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="yaml_reference.html">YAML Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="operation_types.html">Operation Types Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="calculations.html">Calculation Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="units_and_defaults.html">Units and defaults</a></li>
<li class="toctree-l1"><a class="reference internal" href="global_ports.html">Port list</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_formats.html">Output formats</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Help and Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ocean-uhh/cruiseplan">GitHub Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ocean-uhh/cruiseplan/blob/main/CONTRIBUTING.md">Contributing Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_structure.html">Project Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual_testing.html">Manual Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap/index.html">Development Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap/index.html#implementation-notes">Implementation Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap/index.html#risk-assessment">Risk Assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap/index.html#contributing">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CruisePlan v0.3.0</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">CruisePlan Architecture</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cruiseplan-architecture">
<h1>CruisePlan Architecture<a class="headerlink" href="#cruiseplan-architecture" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>CruisePlan organizes cruise operations using a hierarchical grouping system that reflects operational planning needs. This document describes the core architectural concepts for developers and advanced users working with the CruisePlan system.</p>
<p>For complete YAML field definitions and examples, see the :doc:<code class="docutils literal notranslate"><span class="pre">yaml_reference</span></code>. For practical workflows, see the :doc:<code class="docutils literal notranslate"><span class="pre">user_workflows</span></code>.</p>
</section>
<section id="hierarchical-grouping-system">
<h2>Hierarchical Grouping System<a class="headerlink" href="#hierarchical-grouping-system" title="Link to this heading"></a></h2>
<p>CruisePlan uses a flexible multi-level grouping system to organize operations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Cruise (expedition-level container)
  ↓ contains
Legs (operational segments with departure/arrival ports)
  ↓ can contain directly:
    - Activities (individual operations: stations, transits, areas, moorings)
  ↓ or organized into:
    - Clusters (geographic/organizational groupings of activities)
      ↓ which contain:
        - Activities (individual operations)
</pre></div>
</div>
<p><strong>Key Insight</strong>: Each level serves a specific organizational purpose:</p>
<ul class="simple">
<li><p><strong>Cruise</strong>: Overall expedition container with global parameter defaults</p></li>
<li><p><strong>Leg</strong>: Port-to-port segments for routing and logistics (can be auto-created for simple cruises)</p></li>
<li><p><strong>Cluster</strong>: Optional geographic/organizational groupings (e.g., “Northern Sites”, “Deep Water Stations”)</p></li>
<li><p><strong>Activities</strong>: Individual scientific operations that actually get executed</p></li>
</ul>
<p><strong>Simplified Configuration</strong>: For simple single-leg cruises, you can omit the <code class="docutils literal notranslate"><span class="pre">legs</span></code> section entirely. When departure_port and arrival_port are specified at the cruise level along with activities, CruisePlan automatically creates a default leg (see :ref:<code class="docutils literal notranslate"><span class="pre">yaml-reference:simplified-leg-creation</span></code> for details).</p>
</section>
<section id="design-principles">
<h2>Design Principles<a class="headerlink" href="#design-principles" title="Link to this heading"></a></h2>
<section id="hierarchical-organization">
<h3>1. Hierarchical Organization<a class="headerlink" href="#hierarchical-organization" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Cruise</strong>: Top-level expedition container with global parameter defaults</p></li>
<li><p><strong>Legs</strong>: Port-to-port segments for routing and logistics (REQUIRED: <code class="docutils literal notranslate"><span class="pre">departure_port</span></code> + <code class="docutils literal notranslate"><span class="pre">arrival_port</span></code>; can be auto-created)</p></li>
<li><p><strong>Clusters</strong>: Optional geographic/organizational groupings of related activities</p></li>
<li><p><strong>Activities</strong>: Individual scientific operations (stations, transits, areas, moorings)</p></li>
</ul>
</section>
<section id="activities-only-architecture">
<h3>2. Activities-Only Architecture<a class="headerlink" href="#activities-only-architecture" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Single <code class="docutils literal notranslate"><span class="pre">activities</span></code> field replaces confusing field overlap</p></li>
<li><p>No ambiguity about where operations are defined</p></li>
<li><p>Consistent naming across all container levels</p></li>
</ul>
</section>
<section id="parameter-inheritance">
<h3>3. Parameter Inheritance<a class="headerlink" href="#parameter-inheritance" title="Link to this heading"></a></h3>
<p>Natural parameter flow down the hierarchy: <strong>Cruise → Leg → Cluster → Operations</strong></p>
<ul class="simple">
<li><p>Cruise-level defaults (vessel speed, turnaround time, etc.)</p></li>
<li><p>Leg-specific overrides (when explicitly defined in YAML)</p></li>
<li><p>Cluster-specific overrides (planned future enhancement)</p></li>
<li><p>Operation-specific overrides (when explicitly defined in YAML)</p></li>
</ul>
<p><strong>Note</strong>: Currently, only cruise-level and operation-level parameter overrides are implemented in the YAML configuration. Leg-level parameter inheritance is supported in the runtime classes but not yet exposed in YAML configuration.</p>
</section>
<section id="cluster-boundaries">
<h3>4. Cluster Boundaries<a class="headerlink" href="#cluster-boundaries" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Define which operations can be shuffled together for optimization</p></li>
<li><p>Provide strict boundaries for scheduling algorithms</p></li>
<li><p>Enable advanced scheduling strategies (spatial, temporal, etc – <em>not yet implemented</em>)</p></li>
</ul>
</section>
<section id="default-behavior">
<h3>5. Default Behavior<a class="headerlink" href="#default-behavior" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Auto-created legs</strong>: If no legs are defined but departure_port + arrival_port + activities exist at cruise level, auto-create default leg</p></li>
<li><p><strong>Auto-created clusters</strong>: If leg has no explicit clusters, create default cluster from leg activities</p></li>
<li><p>Simplifies common use cases while enabling complex scenarios</p></li>
</ul>
</section>
</section>
<section id="data-models">
<h2>Data Models<a class="headerlink" href="#data-models" title="Link to this heading"></a></h2>
<section id="legdefinition-yaml-configuration">
<h3>LegDefinition (YAML Configuration)<a class="headerlink" href="#legdefinition-yaml-configuration" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">LegDefinition</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># REQUIRED: Maritime legs are always port-to-port</span>
    <span class="n">departure_port</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Port reference (e.g., &quot;port_reykjavik&quot;)</span>
    <span class="n">arrival_port</span><span class="p">:</span> <span class="nb">str</span>    <span class="c1"># Port reference</span>
    
    <span class="c1"># Operational boundaries within the leg</span>
    <span class="n">first_station</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># First operational station</span>
    <span class="n">last_station</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>    <span class="c1"># Last operational station</span>
    
    <span class="c1"># Parameter inheritance from cruise level</span>
    <span class="n">vessel_speed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>              <span class="c1"># Leg-specific vessel speed (knots)</span>
    <span class="n">distance_between_stations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Station spacing (km)</span>
    <span class="n">turnaround_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>           <span class="c1"># Between operations (minutes)</span>
    <span class="n">buffer_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>               <span class="c1"># Leg contingency time (minutes)</span>
    
    <span class="c1"># Activities organization</span>
    <span class="n">activities</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>            <span class="c1"># For default cluster if no explicit clusters</span>
    <span class="n">clusters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ClusterDefinition</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Explicit operational groupings</span>
    <span class="n">ordered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>                              <span class="c1"># Whether default cluster is ordered</span>
</pre></div>
</div>
</section>
<section id="clusterdefinition-yaml-configuration">
<h3>ClusterDefinition (YAML Configuration)<a class="headerlink" href="#clusterdefinition-yaml-configuration" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ClusterDefinition</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Unified activities approach</span>
    <span class="n">activities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># Activity names from global catalog</span>
    <span class="n">ordered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>   <span class="c1"># Whether activities can be shuffled</span>
    <span class="n">strategy</span><span class="p">:</span> <span class="n">StrategyEnum</span> <span class="o">=</span> <span class="n">StrategyEnum</span><span class="o">.</span><span class="n">SEQUENTIAL</span>  <span class="c1"># Scheduling strategy</span>
</pre></div>
</div>
</section>
<section id="portdefinition-yaml-configuration">
<h3>PortDefinition (YAML Configuration)<a class="headerlink" href="#portdefinition-yaml-configuration" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PortDefinition</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>           <span class="c1"># Unique port identifier</span>
    <span class="n">latitude</span><span class="p">:</span> <span class="nb">float</span>     <span class="c1"># Port latitude in decimal degrees</span>
    <span class="n">longitude</span><span class="p">:</span> <span class="nb">float</span>    <span class="c1"># Port longitude in decimal degrees</span>
    <span class="n">timezone</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># Port timezone (e.g., &#39;UTC&#39;)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># Human-readable description</span>
    <span class="n">display_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Pretty name for UI display</span>
</pre></div>
</div>
</section>
</section>
<section id="runtime-objects">
<h2>Runtime Objects<a class="headerlink" href="#runtime-objects" title="Link to this heading"></a></h2>
<section id="leg-class">
<h3>Leg Class<a class="headerlink" href="#leg-class" title="Link to this heading"></a></h3>
<p>The runtime <code class="docutils literal notranslate"><span class="pre">Leg</span></code> class represents an actual cruise leg with resolved references:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Leg</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">departure_port</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PortDefinition</span><span class="p">],</span>  <span class="c1"># REQUIRED</span>
        <span class="n">arrival_port</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PortDefinition</span><span class="p">],</span>    <span class="c1"># REQUIRED</span>
        <span class="n">first_station</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">last_station</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">first_waypoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>   <span class="c1"># Navigation waypoint (not executed)</span>
        <span class="n">last_waypoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>    <span class="c1"># Navigation waypoint (not executed)</span>
    <span class="p">)</span>
    
    <span class="c1"># Parameter inheritance</span>
    <span class="n">vessel_speed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>              <span class="c1"># Inherited from cruise or leg-specific</span>
    <span class="n">distance_between_stations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="c1"># Inherited from cruise or leg-specific  </span>
    <span class="n">turnaround_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>           <span class="c1"># Inherited from cruise or leg-specific</span>
    <span class="n">buffer_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>               <span class="c1"># Leg-specific contingency time</span>
    
    <span class="c1"># Container for operations</span>
    <span class="n">clusters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Cluster</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">get_effective_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cruise_default</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get effective vessel speed with inheritance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vessel_speed</span> <span class="ow">or</span> <span class="n">cruise_default</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">get_effective_turnaround_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cruise_default</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get effective turnaround time with inheritance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">turnaround_time</span> <span class="ow">or</span> <span class="n">cruise_default</span>
</pre></div>
</div>
</section>
<section id="cluster-class">
<h3>Cluster Class<a class="headerlink" href="#cluster-class" title="Link to this heading"></a></h3>
<p>Runtime clusters contain resolved operations with boundary management:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Cluster</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">activities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">ordered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">strategy</span><span class="p">:</span> <span class="n">StrategyEnum</span> <span class="o">=</span> <span class="n">StrategyEnum</span><span class="o">.</span><span class="n">SEQUENTIAL</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="n">operations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseOperation</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Resolved from activities</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">can_shuffle_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether operations in this cluster can be reordered.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ordered</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseOperation</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply scheduling strategy to operations within cluster.&quot;&quot;&quot;</span>
        <span class="c1"># Implementation varies by strategy type</span>
</pre></div>
</div>
</section>
</section>
<section id="port-system">
<h2>Port System<a class="headerlink" href="#port-system" title="Link to this heading"></a></h2>
<section id="global-port-registry">
<h3>Global Port Registry<a class="headerlink" href="#global-port-registry" title="Link to this heading"></a></h3>
<p>CruisePlan includes a global registry of common research ports:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pre-defined ports accessible via references</span>
<span class="s2">&quot;port_reykjavik&quot;</span>     <span class="c1"># Reykjavik, Iceland  </span>
<span class="s2">&quot;port_bergen&quot;</span>        <span class="c1"># Bergen, Norway</span>
<span class="s2">&quot;port_singapore&quot;</span>     <span class="c1"># Singapore</span>
<span class="s2">&quot;port_honolulu&quot;</span>      <span class="c1"># Honolulu, Hawaii</span>
<span class="c1"># ... 20+ additional research ports</span>
</pre></div>
</div>
</section>
<section id="port-resolution">
<h3>Port Resolution<a class="headerlink" href="#port-resolution" title="Link to this heading"></a></h3>
<p>Port references are resolved in this order:</p>
<ol class="arabic simple">
<li><p><strong>Custom ports catalog</strong> in YAML configuration</p></li>
<li><p><strong>Global port registry</strong> for standard references</p></li>
<li><p><strong>Error</strong> if port reference not found</p></li>
</ol>
</section>
<section id="port-expansion">
<h3>Port Expansion<a class="headerlink" href="#port-expansion" title="Link to this heading"></a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">cruiseplan</span> <span class="pre">enrich</span> <span class="pre">--expand-ports</span></code> to convert global port references into local catalog entries:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Before enrichment</span>
legs:
<span class="w">  </span>-<span class="w"> </span>departure_port:<span class="w"> </span>port_reykjavik<span class="w">  </span><span class="c1"># Global reference</span>

<span class="c1"># After enrichment</span>
ports:
<span class="w">  </span>-<span class="w"> </span>name:<span class="w"> </span>port_reykjavik
<span class="w">    </span>latitude:<span class="w"> </span><span class="m">64</span>.1466
<span class="w">    </span>longitude:<span class="w"> </span>-21.9426
<span class="w">    </span>display_name:<span class="w"> </span><span class="s2">&quot;Reykjavik, Iceland&quot;</span>

legs:
<span class="w">  </span>-<span class="w"> </span>departure_port:<span class="w"> </span>port_reykjavik<span class="w">  </span><span class="c1"># Now resolves to catalog entry</span>
</pre></div>
</div>
</section>
</section>
<section id="scheduling-logic">
<h2>Scheduling Logic<a class="headerlink" href="#scheduling-logic" title="Link to this heading"></a></h2>
<section id="port-to-port-routing">
<h3>Port-to-Port Routing<a class="headerlink" href="#port-to-port-routing" title="Link to this heading"></a></h3>
<p>The scheduler implements realistic maritime routing:</p>
<ol class="arabic simple">
<li><p><strong>Inter-leg routing</strong>: <code class="docutils literal notranslate"><span class="pre">previous_leg.arrival_port</span> <span class="pre">→</span> <span class="pre">next_leg.departure_port</span></code></p></li>
<li><p><strong>Pre-leg routing</strong>: <code class="docutils literal notranslate"><span class="pre">departure_port</span> <span class="pre">→</span> <span class="pre">first_station</span></code> (if first_station exists)</p></li>
<li><p><strong>Post-leg routing</strong>: <code class="docutils literal notranslate"><span class="pre">last_station</span> <span class="pre">→</span> <span class="pre">arrival_port</span></code> (if last_station exists)</p></li>
<li><p><strong>Within-leg routing</strong>: Standard operation-to-operation transits</p></li>
</ol>
</section>
<section id="id1">
<h3>Parameter Inheritance<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>Parameters flow down the hierarchy with closer definitions taking precedence:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Current implementation resolution order (highest precedence first):</span>
<span class="mf">1.</span> <span class="n">Operation</span><span class="o">-</span><span class="n">specific</span> <span class="n">parameter</span> <span class="p">(</span><span class="ow">in</span> <span class="n">YAML</span> <span class="n">operation</span> <span class="n">definition</span><span class="p">)</span>
<span class="mf">2.</span> <span class="n">Cruise</span><span class="o">-</span><span class="n">level</span> <span class="n">default</span> <span class="n">parameter</span>
<span class="mf">3.</span> <span class="n">System</span> <span class="n">default</span> <span class="n">value</span>

<span class="c1"># Planned resolution order (future enhancement):</span>
<span class="mf">1.</span> <span class="n">Operation</span><span class="o">-</span><span class="n">specific</span> <span class="n">parameter</span>
<span class="mf">2.</span> <span class="n">Cluster</span><span class="o">-</span><span class="n">specific</span> <span class="n">parameter</span> <span class="p">(</span><span class="k">if</span> <span class="n">operation</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">cluster</span><span class="p">)</span> 
<span class="mf">3.</span> <span class="n">Leg</span><span class="o">-</span><span class="n">specific</span> <span class="n">parameter</span>  
<span class="mf">4.</span> <span class="n">Cruise</span><span class="o">-</span><span class="n">level</span> <span class="n">default</span> <span class="n">parameter</span>
<span class="mf">5.</span> <span class="n">System</span> <span class="n">default</span> <span class="n">value</span>

<span class="c1"># Current example for vessel_speed:</span>
<span class="n">effective_speed</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">operation</span><span class="o">.</span><span class="n">vessel_speed</span> <span class="ow">or</span> 
    <span class="n">cruise</span><span class="o">.</span><span class="n">default_vessel_speed</span> <span class="ow">or</span> 
    <span class="mf">8.0</span>  <span class="c1"># system default</span>
<span class="p">)</span>

<span class="c1"># Future example (when leg/cluster inheritance implemented):</span>
<span class="n">effective_speed</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">operation</span><span class="o">.</span><span class="n">vessel_speed</span> <span class="ow">or</span> 
    <span class="n">cluster</span><span class="o">.</span><span class="n">vessel_speed</span> <span class="ow">or</span>  <span class="c1"># if operation is in a cluster</span>
    <span class="n">leg</span><span class="o">.</span><span class="n">vessel_speed</span> <span class="ow">or</span> 
    <span class="n">cruise</span><span class="o">.</span><span class="n">default_vessel_speed</span> <span class="ow">or</span> 
    <span class="mf">8.0</span>  <span class="c1"># system default</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="cluster-processing">
<h3>Cluster Processing<a class="headerlink" href="#cluster-processing" title="Link to this heading"></a></h3>
<p>Within each leg, clusters are processed in order:</p>
<ol class="arabic simple">
<li><p><strong>Cluster boundaries respected</strong>: Operations cannot be moved between clusters</p></li>
<li><p><strong>Within-cluster shuffling</strong>: Depends on <code class="docutils literal notranslate"><span class="pre">ordered</span></code> flag</p></li>
<li><p><strong>Strategy application</strong>: <code class="docutils literal notranslate"><span class="pre">SEQUENTIAL</span></code>, <code class="docutils literal notranslate"><span class="pre">SPATIAL</span></code>, etc.</p></li>
<li><p><strong>Operation resolution</strong>: Activity names converted to operation objects</p></li>
</ol>
</section>
</section>
<section id="configuration-examples">
<h2>Configuration Examples<a class="headerlink" href="#configuration-examples" title="Link to this heading"></a></h2>
<section id="simple-single-leg-cruise-auto-created-leg">
<h3>Simple Single-Leg Cruise (Auto-Created Leg)<a class="headerlink" href="#simple-single-leg-cruise-auto-created-leg" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simplified configuration - no legs required!</span>
<span class="nt">cruise_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Iceland</span><span class="nv"> </span><span class="s">Survey</span><span class="nv"> </span><span class="s">2024&quot;</span>
<span class="nt">departure_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_reykjavik&quot;</span><span class="w">    </span><span class="c1"># Allowed when no explicit legs</span>
<span class="nt">arrival_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_reykjavik&quot;</span><span class="w">      </span><span class="c1"># Allowed when no explicit legs</span>
<span class="nt">default_vessel_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.0</span>

<span class="nt">stations</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;STN_001&quot;</span>
<span class="w">    </span><span class="nt">latitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64.1</span>
<span class="w">    </span><span class="nt">longitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-21.9</span>
<span class="w">    </span><span class="nt">operation_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CTD&quot;</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;profile&quot;</span>

<span class="c1"># CruisePlan automatically creates:</span>
<span class="c1"># legs:</span>
<span class="c1">#   - name: &quot;Iceland Survey 2024_DefaultLeg&quot;</span>
<span class="c1">#     departure_port: &quot;port_reykjavik&quot;</span>
<span class="c1">#     arrival_port: &quot;port_reykjavik&quot;</span>
<span class="c1">#     activities: [&quot;STN_001&quot;]</span>
</pre></div>
</div>
</section>
<section id="explicit-single-leg-cruise">
<h3>Explicit Single-Leg Cruise<a class="headerlink" href="#explicit-single-leg-cruise" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic cruise with explicit leg and default cluster</span>
<span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_reykjavik&quot;</span>
<span class="w">    </span><span class="nt">latitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64.1466</span>
<span class="w">    </span><span class="nt">longitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-21.9426</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Reykjavik,</span><span class="nv"> </span><span class="s">Iceland&quot;</span>

<span class="nt">legs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Iceland_Survey_2024&quot;</span>
<span class="w">    </span><span class="nt">departure_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_reykjavik&quot;</span>
<span class="w">    </span><span class="nt">arrival_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_reykjavik&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="nt">vessel_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.0</span>
<span class="w">    </span><span class="nt">activities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;STN_001&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;STN_002&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;STN_003&quot;</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># Creates default cluster</span>
</pre></div>
</div>
</section>
<section id="multi-leg-expedition">
<h3>Multi-Leg Expedition<a class="headerlink" href="#multi-leg-expedition" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Complex expedition with port calls</span>
<span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_reykjavik&quot;</span>
<span class="w">    </span><span class="nt">latitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64.1466</span>
<span class="w">    </span><span class="nt">longitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-21.9426</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Reykjavik,</span><span class="nv"> </span><span class="s">Iceland&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_longyearbyen&quot;</span>
<span class="w">    </span><span class="nt">latitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">78.2232</span>
<span class="w">    </span><span class="nt">longitude</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15.6267</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Longyearbyen,</span><span class="nv"> </span><span class="s">Svalbard&quot;</span>

<span class="nt">legs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Transit_to_Svalbard&quot;</span>
<span class="w">    </span><span class="nt">departure_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_reykjavik&quot;</span>
<span class="w">    </span><span class="nt">arrival_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_longyearbyen&quot;</span>
<span class="w">    </span><span class="nt">vessel_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12.0</span><span class="w">  </span><span class="c1"># Higher speed for transit</span>
<span class="w">    </span><span class="nt">first_station</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TRANS_001&quot;</span>
<span class="w">    </span><span class="nt">last_station</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TRANS_005&quot;</span>
<span class="w">    </span><span class="nt">activities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;TRANS_001&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;TRANS_002&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;TRANS_003&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;TRANS_004&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;TRANS_005&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Svalbard_Operations&quot;</span>
<span class="w">    </span><span class="nt">departure_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_longyearbyen&quot;</span>
<span class="w">    </span><span class="nt">arrival_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_longyearbyen&quot;</span>
<span class="w">    </span><span class="nt">vessel_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.0</span><span class="w">   </span><span class="c1"># Slower speed for operations</span>
<span class="w">    </span><span class="nt">first_station</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SVL_001&quot;</span>
<span class="w">    </span><span class="nt">last_station</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SVL_020&quot;</span>
<span class="w">    </span><span class="nt">clusters</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Western_Transect&quot;</span>
<span class="w">        </span><span class="nt">activities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;SVL_001&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;SVL_002&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;SVL_003&quot;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">ordered</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># Can shuffle for efficiency</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Eastern_Transect&quot;</span>
<span class="w">        </span><span class="nt">activities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;SVL_018&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;SVL_019&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;SVL_020&quot;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">ordered</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Return_Transit&quot;</span>
<span class="w">    </span><span class="nt">departure_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_longyearbyen&quot;</span>
<span class="w">    </span><span class="nt">arrival_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_reykjavik&quot;</span>
<span class="w">    </span><span class="nt">vessel_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12.0</span>
<span class="w">    </span><span class="nt">activities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;RTN_001&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;RTN_002&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;RTN_003&quot;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</section>
<section id="advanced-cluster-organization">
<h3>Advanced Cluster Organization<a class="headerlink" href="#advanced-cluster-organization" title="Link to this heading"></a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Complex cluster boundaries and strategies</span>
<span class="nt">legs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Arctic_Survey_2024&quot;</span>
<span class="w">    </span><span class="nt">departure_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_tromso&quot;</span>
<span class="w">    </span><span class="nt">arrival_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_tromso&quot;</span>
<span class="w">    </span><span class="nt">vessel_speed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8.0</span>
<span class="w">    </span><span class="nt">buffer_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">480</span><span class="w">  </span><span class="c1"># 8 hours weather contingency</span>
<span class="w">    </span><span class="nt">clusters</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deep_Water_CTD&quot;</span>
<span class="w">        </span><span class="nt">activities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;ARC_001&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ARC_002&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ARC_003&quot;</span><span class="p p-Indicator">]</span><span class="w"> </span>
<span class="w">        </span><span class="nt">ordered</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># Spatial optimization allowed</span>
<span class="w">        </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;spatial_interleaved&quot;</span>
<span class="w">        </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Mooring_Deployment&quot;</span>
<span class="w">        </span><span class="nt">activities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;MOOR_A_Deploy&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;Trilateration_Survey&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;MOOR_A_Release&quot;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">ordered</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">   </span><span class="c1"># Strict sequence required</span>
<span class="w">        </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sequential&quot;</span>
<span class="w">        </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Shallow_Survey&quot;</span>
<span class="w">        </span><span class="nt">activities</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;ARC_045&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ARC_046&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ARC_047&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ARC_048&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ARC_049&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ARC_050&quot;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">ordered</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># Efficiency optimization</span>
<span class="w">        </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;spatial_interleaved&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="development-guidelines">
<h2>Development Guidelines<a class="headerlink" href="#development-guidelines" title="Link to this heading"></a></h2>
<section id="adding-new-ports">
<h3>Adding New Ports<a class="headerlink" href="#adding-new-ports" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>For global ports</strong>: Add to <code class="docutils literal notranslate"><span class="pre">cruiseplan/utils/global_ports.py</span></code></p></li>
<li><p><strong>For project-specific ports</strong>: Add to YAML <code class="docutils literal notranslate"><span class="pre">ports:</span></code> section</p></li>
<li><p><strong>Always include</strong>: <code class="docutils literal notranslate"><span class="pre">latitude</span></code>, <code class="docutils literal notranslate"><span class="pre">longitude</span></code>, <code class="docutils literal notranslate"><span class="pre">display_name</span></code></p></li>
<li><p><strong>Consider</strong>: timezone information for international expeditions</p></li>
</ol>
</section>
<section id="extending-operation-types">
<h3>Extending Operation Types<a class="headerlink" href="#extending-operation-types" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Add to validation models</strong>: Extend <code class="docutils literal notranslate"><span class="pre">OperationTypeEnum</span></code> in <code class="docutils literal notranslate"><span class="pre">cruiseplan/core/validation.py</span></code></p></li>
<li><p><strong>Add resolver function</strong>: Create <code class="docutils literal notranslate"><span class="pre">_resolve_[type]_details()</span></code> in scheduler</p></li>
<li><p><strong>Add operation class</strong>: Extend <code class="docutils literal notranslate"><span class="pre">BaseOperation</span></code> in <code class="docutils literal notranslate"><span class="pre">cruiseplan/core/operations.py</span></code></p></li>
<li><p><strong>Update duration calculator</strong>: Add duration logic in <code class="docutils literal notranslate"><span class="pre">cruiseplan/calculators/duration.py</span></code></p></li>
</ol>
</section>
<section id="custom-scheduling-strategies">
<h3>Custom Scheduling Strategies<a class="headerlink" href="#custom-scheduling-strategies" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Extend StrategyEnum</strong>: Add new strategy types</p></li>
<li><p><strong>Implement strategy logic</strong>: In <code class="docutils literal notranslate"><span class="pre">Cluster.apply_strategy()</span></code></p></li>
<li><p><strong>Consider cluster boundaries</strong>: Strategies only operate within clusters</p></li>
<li><p><strong>Test edge cases</strong>: Empty clusters, single operations, etc.</p></li>
</ol>
</section>
<section id="entry-exit-point-abstraction">
<h3>Entry/Exit Point Abstraction<a class="headerlink" href="#entry-exit-point-abstraction" title="Link to this heading"></a></h3>
<p><strong>Core Routing Principle</strong>:
Scheduling creates a continuous expedition path by connecting exit points to entry points between operations</p>
<p><strong>Implementation Concept</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_cruise_track</span><span class="p">(</span><span class="n">operations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Operation</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Connect exit point of one operation to entry point of next operation</span>
<span class="sd">    to create complete cruise track</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cruise_track</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">operations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">current_op</span> <span class="o">=</span> <span class="n">operations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">next_op</span> <span class="o">=</span> <span class="n">operations</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="c1"># Connect exit of current operation to entry of next operation</span>
        <span class="n">transit</span> <span class="o">=</span> <span class="n">create_transit</span><span class="p">(</span>
            <span class="n">start</span><span class="o">=</span><span class="n">current_op</span><span class="o">.</span><span class="n">get_exit_point</span><span class="p">(),</span> 
            <span class="n">end</span><span class="o">=</span><span class="n">next_op</span><span class="o">.</span><span class="n">get_entry_point</span><span class="p">()</span>
        <span class="p">)</span>
        
        <span class="n">cruise_track</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
            <span class="n">current_op</span><span class="p">,</span>
            <span class="n">transit</span><span class="p">,</span>
            <span class="n">next_op</span>
        <span class="p">])</span>
    
    <span class="k">return</span> <span class="n">cruise_track</span>
</pre></div>
</div>
<p><strong>Key Characteristics</strong>:</p>
<ul class="simple">
<li><p><strong>Seamless Transitions</strong>: Automatic connection between operations</p></li>
<li><p><strong>Flexible Path Generation</strong>: Works across different operation types</p></li>
<li><p><strong>Predictable Routing</strong>: Clear method for determining cruise track</p></li>
</ul>
<p><strong>Benefits</strong>:</p>
<ul class="simple">
<li><p>Enables complex expedition routing</p></li>
<li><p>Works across different operation types</p></li>
<li><p>Provides a standardized way to generate cruise tracks</p></li>
</ul>
</section>
</section>
<section id="migration-from-legacy-architecture">
<h2>Migration from Legacy Architecture<a class="headerlink" href="#migration-from-legacy-architecture" title="Link to this heading"></a></h2>
<section id="deprecated-fields">
<h3>Deprecated Fields<a class="headerlink" href="#deprecated-fields" title="Link to this heading"></a></h3>
<p>The following fields are deprecated and will be removed in v0.3.0:</p>
<p><strong>LegDefinition deprecated fields</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sequence</span></code> → Use <code class="docutils literal notranslate"><span class="pre">activities</span></code> field</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stations</span></code> → Use <code class="docutils literal notranslate"><span class="pre">activities</span></code> field</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sections</span></code> → Use <code class="docutils literal notranslate"><span class="pre">activities</span></code> field</p></li>
</ul>
<p><strong>ClusterDefinition deprecated fields</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sequence</span></code> → Use <code class="docutils literal notranslate"><span class="pre">activities</span></code> field</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stations</span></code> → Use <code class="docutils literal notranslate"><span class="pre">activities</span></code> field</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">generate_transect</span></code> → Use <code class="docutils literal notranslate"><span class="pre">activities</span></code> field</p></li>
</ul>
</section>
<section id="migration-strategy">
<h3>Migration Strategy<a class="headerlink" href="#migration-strategy" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Update field names</strong>: Replace deprecated fields with <code class="docutils literal notranslate"><span class="pre">activities</span></code></p></li>
<li><p><strong>Add port requirements</strong>: Ensure all legs have <code class="docutils literal notranslate"><span class="pre">departure_port</span></code> and <code class="docutils literal notranslate"><span class="pre">arrival_port</span></code></p></li>
<li><p><strong>Test with warnings</strong>: Run existing configs to see deprecation warnings</p></li>
<li><p><strong>Use enrichment tools</strong>: <code class="docutils literal notranslate"><span class="pre">cruiseplan</span> <span class="pre">enrich</span> <span class="pre">--expand-ports</span></code> for port catalog</p></li>
</ol>
</section>
<section id="backward-compatibility">
<h3>Backward Compatibility<a class="headerlink" href="#backward-compatibility" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Current version</strong>: All deprecated fields functional with warnings</p></li>
<li><p><strong>v0.3.0</strong>: Deprecated fields will be removed (breaking change)</p></li>
<li><p><strong>Migration period</strong>: Deprecation warnings guide users to new format</p></li>
</ul>
</section>
</section>
<section id="architecture-benefits">
<h2>Architecture Benefits<a class="headerlink" href="#architecture-benefits" title="Link to this heading"></a></h2>
<p>✅ <strong>Maritime Accuracy</strong>: Legs correctly represent port-to-port segments<br />
✅ <strong>Clear Hierarchy</strong>: Unambiguous container relationships<br />
✅ <strong>Parameter Inheritance</strong>: Natural flow from cruise to operation level<br />
✅ <strong>Flexible Organization</strong>: Simple default clusters and complex explicit clusters<br />
✅ <strong>Operational Reality</strong>: Reflects actual maritime cruise operations<br />
✅ <strong>Validation</strong>: Clear rules about required fields and references<br />
✅ <strong>Extensibility</strong>: Easy to add new operation types and scheduling strategies<br />
✅ <strong>Port Management</strong>: Consistent global and custom port handling</p>
</section>
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Link to this heading"></a></h2>
<section id="memory-usage">
<h3>Memory Usage<a class="headerlink" href="#memory-usage" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Reference resolution</strong>: Activity names resolved to operation objects during timeline generation</p></li>
<li><p><strong>Port object creation</strong>: Each port reference creates a new PortDefinition object (no sharing)</p></li>
<li><p><strong>Cluster boundaries</strong>: Limit search space for optimization algorithms</p></li>
</ul>
</section>
<section id="scheduling-performance">
<h3>Scheduling Performance<a class="headerlink" href="#scheduling-performance" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Cluster isolation</strong>: Optimization algorithms work within cluster boundaries</p></li>
<li><p><strong>Parameter resolution</strong>: Inherited parameters resolved on-demand via simple conditionals</p></li>
<li><p><strong>Port lookups</strong>: Global port registry optimized for fast access</p></li>
</ul>
</section>
<section id="large-expeditions">
<h3>Large Expeditions<a class="headerlink" href="#large-expeditions" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Leg separation</strong>: Multi-leg cruises process independently</p></li>
<li><p><strong>Cluster parallelization</strong>: Unordered clusters can be processed in parallel</p></li>
<li><p><strong>Memory efficient</strong>: Timeline generation streams through activities</p></li>
</ul>
<p>This architecture provides a solid foundation for complex maritime cruise planning while maintaining simplicity for common use cases.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="demo-output.html" class="btn btn-neutral float-left" title="CruisePlan Demo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cli_reference.html" class="btn btn-neutral float-right" title="CLI Command Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>