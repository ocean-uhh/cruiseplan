

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CruisePlan Demo &mdash; CruisePlan v0.1 v0.1.0.post1.dev13</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=393fce2e" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=08d5d5e7"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CLI Command Reference" href="cli_reference.html" />
    <link rel="prev" title="Overview" href="user_workflows.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CruisePlan v0.1
              <img src="_static/cruise_plan_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">CLI Workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="user_workflows.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_workflows.html#path-1-basic-planning-workflow">Path 1: Basic Planning Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_workflows.html#path-2-pangaea-enhanced-workflow">Path 2: PANGAEA-Enhanced Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_workflows.html#path-3-configuration-only-workflow">Path 3: Configuration-Only Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_workflows.html#advanced-topics">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_workflows.html#troubleshooting">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Notebook Workflow</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">CruisePlan Demo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Workflow-Overview">Workflow Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Setup-and-Imports">Setup and Imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-1:-Download-Bathymetry-Data">Step 1: Download Bathymetry Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-2:-Search-PANGAEA-Database">Step 2: Search PANGAEA Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-3:-Process-PANGAEA-Campaigns">Step 3: Process PANGAEA Campaigns</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-4:-Create-Station-Configuration">Step 4: Create Station Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-5:-Validate-Configuration">Step 5: Validate Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-6:-Enrich-Configuration">Step 6: Enrich Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-7:-Generate-Maps">Step 7: Generate Maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Step-8:-Generate-Schedule">Step 8: Generate Schedule</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Workflow-Summary">Workflow Summary</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Specifications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cli_reference.html">CLI Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="yaml_reference.html">YAML Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="units_and_defaults.html">Units and defaults</a></li>
<li class="toctree-l1"><a class="reference internal" href="netcdf_outputs.html">NetCDF Data Standards</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Help and Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ocean-uhh/cruiseplan">GitHub Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ocean-uhh/cruiseplan/blob/main/CONTRIBUTING.md">Contributing Guidelines</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CruisePlan v0.1</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">CruisePlan Demo</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="CruisePlan-Demo">
<h1>CruisePlan Demo<a class="headerlink" href="#CruisePlan-Demo" title="Link to this heading">ÔÉÅ</a></h1>
<p>This notebook demonstrates the complete CruisePlan workflow using Python functions rather than CLI commands. Each section corresponds to a CLI subcommand and shows how to accomplish the same tasks programmatically.</p>
<section id="Workflow-Overview">
<h2>Workflow Overview<a class="headerlink" href="#Workflow-Overview" title="Link to this heading">ÔÉÅ</a></h2>
<ol class="arabic simple">
<li><p><strong>Download</strong>: Get bathymetry data for depth calculations</p></li>
<li><p><strong>Pandoi</strong>: Search PANGAEA database for relevant oceanographic datasets</p></li>
<li><p><strong>Pangaea</strong>: Process DOI list into campaign dataset</p></li>
<li><p><strong>Stations</strong>: Interactive station planning (or programmatic configuration)</p></li>
<li><p><strong>Validate</strong>: Check configuration for errors and warnings</p></li>
<li><p><strong>Enrich</strong>: Add computed data (depths, coordinates, expand sections)</p></li>
<li><p><strong>Map</strong>: Create visualization maps</p></li>
<li><p><strong>Schedule</strong>: Generate cruise timeline and outputs</p></li>
</ol>
<p>All outputs will be saved to <code class="docutils literal notranslate"><span class="pre">tests_output/demo/</span></code> for easy exploration.</p>
</section>
<section id="Setup-and-Imports">
<h2>Setup and Imports<a class="headerlink" href="#Setup-and-Imports" title="Link to this heading">ÔÉÅ</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Core imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">cruiseplan.calculators.scheduler</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_cruise_schedule</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cruiseplan.core.cruise</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cruise</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cruiseplan.core.validation</span><span class="w"> </span><span class="kn">import</span> <span class="n">enrich_configuration</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cruiseplan.data.bathymetry</span><span class="w"> </span><span class="kn">import</span> <span class="n">BathymetryManager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cruiseplan.data.pangaea</span><span class="w"> </span><span class="kn">import</span> <span class="n">PangaeaManager</span><span class="p">,</span> <span class="n">save_campaign_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cruiseplan.output.map_generator</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_map_from_yaml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cruiseplan.utils.yaml_io</span><span class="w"> </span><span class="kn">import</span> <span class="n">save_yaml</span>

<span class="c1"># Set up output directory</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../tests_output/demo&#39;</span><span class="p">)</span>
<span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Demo outputs will be saved to: </span><span class="si">{</span><span class="n">output_dir</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Configure logging to see what&#39;s happening</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Demo outputs will be saved to: /home/runner/work/cruiseplan/cruiseplan/notebooks/../tests_output/demo
</pre></div></div>
</div>
</section>
<section id="Step-1:-Download-Bathymetry-Data">
<h2>Step 1: Download Bathymetry Data<a class="headerlink" href="#Step-1:-Download-Bathymetry-Data" title="Link to this heading">ÔÉÅ</a></h2>
<p><strong>CLI Equivalent</strong>: <code class="docutils literal notranslate"><span class="pre">cruiseplan</span> <span class="pre">download</span> <span class="pre">--bathymetry-source</span> <span class="pre">etopo2022</span></code></p>
<p>First, we need bathymetry data for depth calculations and visualization.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize bathymetry manager with ETOPO2022 data</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üì• Downloading bathymetry data...&quot;</span><span class="p">)</span>
<span class="n">bathymetry</span> <span class="o">=</span> <span class="n">BathymetryManager</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s2">&quot;etopo2022&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO: ‚ö†Ô∏è No bathymetry file found at /home/runner/work/cruiseplan/cruiseplan/data/bathymetry/ETOPO_2022_v1_60s_N90W180_bed.nc. Using MOCK mode.
INFO:    Run `cruiseplan.data.bathymetry.download_bathymetry()` to fetch it.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
üì• Downloading bathymetry data...
</pre></div></div>
</div>
</section>
<section id="Step-2:-Search-PANGAEA-Database">
<h2>Step 2: Search PANGAEA Database<a class="headerlink" href="#Step-2:-Search-PANGAEA-Database" title="Link to this heading">ÔÉÅ</a></h2>
<p><strong>CLI Equivalent</strong>: <code class="docutils literal notranslate"><span class="pre">cruiseplan</span> <span class="pre">pandoi</span> <span class="pre">&quot;CTD</span> <span class="pre">temperature&quot;</span> <span class="pre">--lat</span> <span class="pre">50</span> <span class="pre">70</span> <span class="pre">--lon</span> <span class="pre">-60</span> <span class="pre">-30</span> <span class="pre">--limit</span> <span class="pre">15</span></code></p>
<p>Search for relevant oceanographic datasets to inform our cruise planning.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üîç Searching PANGAEA database...&quot;</span><span class="p">)</span>

<span class="c1"># Initialize PANGAEA manager</span>
<span class="n">pangaea_mgr</span> <span class="o">=</span> <span class="n">PangaeaManager</span><span class="p">()</span>

<span class="c1"># Define search parameters</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;CTD&quot;</span> <span class="c1"># or &quot;CTD temperature North Atlantic&quot;</span>
<span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>  <span class="c1"># (min_lon, min_lat, max_lon, max_lat)</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">5</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Query: &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Geographic bounds: 50¬∞N-70¬∞N, 60¬∞W-30¬∞W&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Limit: </span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2"> datasets&quot;</span><span class="p">)</span>

<span class="c1"># Perform search</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="n">pangaea_mgr</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span><span class="si">}</span><span class="s2"> datasets&quot;</span><span class="p">)</span>

    <span class="c1"># Extract DOIs and save to file</span>
    <span class="n">dois</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;doi&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">datasets</span> <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;doi&#39;</span><span class="p">)]</span>

    <span class="c1"># Save DOI list</span>
    <span class="n">doi_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;demo_dois.txt&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">doi_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">doi</span> <span class="ow">in</span> <span class="n">dois</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">doi</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   DOI list saved to: </span><span class="si">{</span><span class="n">doi_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   First few DOIs: </span><span class="si">{</span><span class="n">dois</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Search failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Create a minimal DOI list for demo purposes</span>
    <span class="n">doi_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;demo_dois.txt&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">doi_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;10.1594/PANGAEA.123456</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Created minimal DOI file for demo: </span><span class="si">{</span><span class="n">doi_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO: Searching Pangaea: &#39;CTD&#39; (Limit: 5)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
üîç Searching PANGAEA database...
   Query: &#39;CTD&#39;
   Geographic bounds: 50¬∞N-70¬∞N, 60¬∞W-30¬∞W
   Limit: 5 datasets
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO: Search found 1823 total matches. Retrieving first 5...
INFO: Fetching PANGAEA dataset: 10.1594/PANGAEA.755512
INFO: Fetching PANGAEA dataset: 10.1594/PANGAEA.604878
INFO: Fetching PANGAEA dataset: 10.1594/PANGAEA.604842
INFO: Fetching PANGAEA dataset: 10.1594/PANGAEA.604887
INFO: Fetching PANGAEA dataset: 10.1594/PANGAEA.604857
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
‚úÖ Found 5 datasets
   DOI list saved to: ../tests_output/demo/demo_dois.txt
   First few DOIs: [&#39;10.1594/PANGAEA.755512&#39;, &#39;10.1594/PANGAEA.604878&#39;, &#39;10.1594/PANGAEA.604842&#39;]
</pre></div></div>
</div>
</section>
<section id="Step-3:-Process-PANGAEA-Campaigns">
<h2>Step 3: Process PANGAEA Campaigns<a class="headerlink" href="#Step-3:-Process-PANGAEA-Campaigns" title="Link to this heading">ÔÉÅ</a></h2>
<p><strong>CLI Equivalent</strong>: <code class="docutils literal notranslate"><span class="pre">cruiseplan</span> <span class="pre">pangaea</span> <span class="pre">demo_dois.txt</span> <span class="pre">-o</span> <span class="pre">tests_output/demo/</span></code></p>
<p>Process the DOI list to extract campaign coordinates and metadata.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read the DOI list</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;demo_dois.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">dois</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìä Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dois</span><span class="p">)</span><span class="si">}</span><span class="s2"> PANGAEA DOIs...&quot;</span><span class="p">)</span>

<span class="c1"># Create manager and fetch datasets</span>
<span class="n">manager</span> <span class="o">=</span> <span class="n">PangaeaManager</span><span class="p">()</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">fetch_datasets</span><span class="p">(</span>
    <span class="n">doi_list</span><span class="o">=</span><span class="n">dois</span><span class="p">,</span>
    <span class="n">rate_limit</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">merge_campaigns</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>


<span class="k">if</span> <span class="n">datasets</span><span class="p">:</span>
    <span class="c1"># Save using the CLI&#39;s save function</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;ctd_pangaea_data.pkl&quot;</span><span class="p">)</span>
    <span class="n">save_campaign_data</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ Saved </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span><span class="si">}</span><span class="s2"> campaign tracks to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ö†Ô∏è No datasets retrieved&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
üìä Processing 5 PANGAEA DOIs...
‚úÖ Saved 2 campaign tracks to ../tests_output/demo/ctd_pangaea_data.pkl
</pre></div></div>
</div>
</section>
<section id="Step-4:-Create-Station-Configuration">
<h2>Step 4: Create Station Configuration<a class="headerlink" href="#Step-4:-Create-Station-Configuration" title="Link to this heading">ÔÉÅ</a></h2>
<p><strong>CLI Equivalent</strong>: <code class="docutils literal notranslate"><span class="pre">cruiseplan</span> <span class="pre">stations</span> <span class="pre">--pangaea-file</span> <span class="pre">campaigns.pkl</span> <span class="pre">--lat</span> <span class="pre">50</span> <span class="pre">70</span> <span class="pre">--lon</span> <span class="pre">-60</span> <span class="pre">-30</span></code></p>
<p>For this demo, we‚Äôll create a programmatic station configuration rather than using the interactive interface.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üó∫Ô∏è  Creating station configuration...&quot;</span><span class="p">)</span>

<span class="c1"># Create a sample cruise configuration</span>
<span class="n">cruise_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cruise_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Demo North Atlantic Survey 2025&#39;</span><span class="p">,</span>
    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Demonstration cruise for CruisePlan workflow&#39;</span><span class="p">,</span>
    <span class="s1">&#39;default_vessel_speed&#39;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
    <span class="s1">&#39;turnaround_time&#39;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>
    <span class="s1">&#39;ctd_descent_rate&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s1">&#39;ctd_ascent_rate&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s1">&#39;calculate_transfer_between_sections&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;calculate_depth_via_bathymetry&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;start_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2025-06-01T00:00:00Z&#39;</span><span class="p">,</span>
    <span class="s1">&#39;departure_port&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;St. Johns&#39;</span><span class="p">,</span>
        <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">47.5615</span><span class="p">,</span>
            <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">52.7126</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;arrival_port&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;St. Johns&#39;</span><span class="p">,</span>
        <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">47.5615</span><span class="p">,</span>
            <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">52.7126</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;first_station&#39;</span><span class="p">:</span> <span class="s1">&#39;STN_001&#39;</span><span class="p">,</span>
    <span class="s1">&#39;last_station&#39;</span><span class="p">:</span> <span class="s1">&#39;STN_006&#39;</span><span class="p">,</span>

    <span class="c1"># Define stations along a transect</span>
    <span class="s1">&#39;stations&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;STN_001&#39;</span><span class="p">,</span>
            <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">55.0</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">50.0</span><span class="p">},</span>
            <span class="s1">&#39;operation_type&#39;</span><span class="p">:</span> <span class="s1">&#39;CTD&#39;</span><span class="p">,</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span>
            <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;Continental shelf station&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;STN_002&#39;</span><span class="p">,</span>
            <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">57.0</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">45.0</span><span class="p">},</span>
            <span class="s1">&#39;operation_type&#39;</span><span class="p">:</span> <span class="s1">&#39;CTD&#39;</span><span class="p">,</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span>
            <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;Slope station&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;STN_003&#39;</span><span class="p">,</span>
            <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">59.0</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">40.0</span><span class="p">},</span>
            <span class="s1">&#39;operation_type&#39;</span><span class="p">:</span> <span class="s1">&#39;CTD&#39;</span><span class="p">,</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span>
            <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;Deep water station&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;STN_004&#39;</span><span class="p">,</span>
            <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">61.0</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">35.0</span><span class="p">},</span>
            <span class="s1">&#39;operation_type&#39;</span><span class="p">:</span> <span class="s1">&#39;water_sampling&#39;</span><span class="p">,</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;sampling&#39;</span><span class="p">,</span>
            <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="mf">180.0</span><span class="p">,</span>
            <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;Water sampling station&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;MOOR_001&#39;</span><span class="p">,</span>
            <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">60.5</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">38.0</span><span class="p">},</span>
            <span class="s1">&#39;operation_type&#39;</span><span class="p">:</span> <span class="s1">&#39;mooring&#39;</span><span class="p">,</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;deployment&#39;</span><span class="p">,</span>
            <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="mf">240.0</span><span class="p">,</span>
            <span class="s1">&#39;delay_start&#39;</span><span class="p">:</span> <span class="mf">60.0</span><span class="p">,</span>  <span class="c1"># Wait for daylight</span>
            <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;Mooring deployment&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;STN_005&#39;</span><span class="p">,</span>
            <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">63.0</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">30.0</span><span class="p">},</span>
            <span class="s1">&#39;operation_type&#39;</span><span class="p">:</span> <span class="s1">&#39;CTD&#39;</span><span class="p">,</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span>
            <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;Northern end station&#39;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;STN_006&#39;</span><span class="p">,</span>
            <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">58.0</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">42.0</span><span class="p">},</span>
            <span class="s1">&#39;operation_type&#39;</span><span class="p">:</span> <span class="s1">&#39;CTD&#39;</span><span class="p">,</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;profile&#39;</span><span class="p">,</span>
            <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;Return transect station&#39;</span>
        <span class="p">}</span>
    <span class="p">],</span>

    <span class="c1"># Add a CTD section that can be expanded</span>
    <span class="s1">&#39;transits&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Demo_CTD_Section&#39;</span><span class="p">,</span>
            <span class="s1">&#39;operation_type&#39;</span><span class="p">:</span> <span class="s1">&#39;CTD&#39;</span><span class="p">,</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;section&#39;</span><span class="p">,</span>
            <span class="s1">&#39;route&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">56.0</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">48.0</span><span class="p">},</span>
                <span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="mf">56.0</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">38.0</span><span class="p">}</span>
            <span class="p">],</span>
            <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="s1">&#39;Zonal CTD section for expansion&#39;</span>
        <span class="p">}</span>
    <span class="p">],</span>

    <span class="c1"># Define execution order</span>
    <span class="s1">&#39;legs&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Outbound_Survey&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Outbound transect with mooring deployment&#39;</span><span class="p">,</span>
            <span class="s1">&#39;buffer_time&#39;</span><span class="p">:</span> <span class="mf">120.0</span><span class="p">,</span>  <span class="c1"># 2h weather contingency</span>
            <span class="s1">&#39;strategy&#39;</span><span class="p">:</span> <span class="s1">&#39;sequential&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;STN_001&#39;</span><span class="p">,</span> <span class="s1">&#39;STN_002&#39;</span><span class="p">,</span> <span class="s1">&#39;STN_003&#39;</span><span class="p">,</span> <span class="s1">&#39;STN_004&#39;</span><span class="p">,</span> <span class="s1">&#39;MOOR_001&#39;</span><span class="p">,</span> <span class="s1">&#39;STN_005&#39;</span><span class="p">],</span>
            <span class="s1">&#39;transits&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Demo_CTD_Section&#39;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Return_Survey&#39;</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Return transect&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;STN_006&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Save configuration</span>
<span class="n">config_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;demo_cruise.yaml&quot;</span>
<span class="n">save_yaml</span><span class="p">(</span><span class="n">cruise_config</span><span class="p">,</span> <span class="n">config_file</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Station configuration created&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Configuration saved to: </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Stations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cruise_config</span><span class="p">[</span><span class="s1">&#39;stations&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Transits: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cruise_config</span><span class="p">[</span><span class="s1">&#39;transits&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Legs: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cruise_config</span><span class="p">[</span><span class="s1">&#39;legs&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO: Saved configuration to: ../tests_output/demo/demo_cruise.yaml
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
üó∫Ô∏è  Creating station configuration...
‚úÖ Station configuration created
   Configuration saved to: ../tests_output/demo/demo_cruise.yaml
   Stations: 7
   Transits: 1
   Legs: 2
</pre></div></div>
</div>
</section>
<section id="Step-5:-Validate-Configuration">
<h2>Step 5: Validate Configuration<a class="headerlink" href="#Step-5:-Validate-Configuration" title="Link to this heading">ÔÉÅ</a></h2>
<p><strong>CLI Equivalent</strong>: <code class="docutils literal notranslate"><span class="pre">cruiseplan</span> <span class="pre">validate</span> <span class="pre">-c</span> <span class="pre">demo_cruise.yaml</span> <span class="pre">--check-depths</span></code></p>
<p>Check the configuration for errors and potential issues.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Validating configuration...&quot;</span><span class="p">)</span>

<span class="n">config_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;demo_cruise.yaml&quot;</span>
<span class="n">cruise</span> <span class="o">=</span> <span class="n">Cruise</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>

<span class="c1"># The Cruise.__init__() automatically performs validation during loading</span>
<span class="c1"># including Pydantic model validation and cruise-specific validation</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Configuration loaded and validated successfully!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cruise</span><span class="o">.</span><span class="n">station_registry</span><span class="p">)</span><span class="si">}</span><span class="s2"> station definitions&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cruise</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">legs</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">[])</span><span class="si">}</span><span class="s2"> leg definitions&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cruise</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s1">&#39;transits&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cruise</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transits</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cruise</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">transits</span><span class="p">)</span><span class="si">}</span><span class="s2"> transit definitions&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cruise</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="s1">&#39;schedule&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cruise</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">schedule</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cruise</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">schedule</span><span class="p">)</span><span class="si">}</span><span class="s2"> scheduled items&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
‚úÖ Validating configuration...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValidationError</span>                           Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[6]</span><span class="ansi-green-fg">, line 4</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">‚úÖ Validating configuration...</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      3</span> config_file = output_dir / <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">demo_cruise.yaml</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">4</span> cruise = <span class="ansi-yellow-bg">Cruise</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">config_file</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      6</span> <span style="color: rgb(95,135,135)"># The Cruise.__init__() automatically performs validation during loading</span>
<span class="ansi-green-fg">      7</span> <span style="color: rgb(95,135,135)"># including Pydantic model validation and cruise-specific validation</span>
<span class="ansi-green-fg">      8</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">‚úÖ Configuration loaded and validated successfully!</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/work/cruiseplan/cruiseplan/cruiseplan/core/cruise.py:84</span>, in <span class="ansi-cyan-fg">Cruise.__init__</span><span class="ansi-blue-fg">(self, config_path)</span>
<span class="ansi-green-fg">     81</span> <span style="color: rgb(0,135,0)">self</span>.raw_data = <span style="color: rgb(0,135,0)">self</span>._load_yaml()
<span class="ansi-green-fg">     83</span> <span style="color: rgb(95,135,135)"># 1. Validation Pass (Pydantic)</span>
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">84</span> <span style="color: rgb(0,135,0)">self</span>.config = <span class="ansi-yellow-bg">CruiseConfig</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">raw_data</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">     86</span> <span style="color: rgb(95,135,135)"># 2. Indexing Pass (Build the Catalog Registry)</span>
<span class="ansi-green-fg">     87</span> <span style="color: rgb(0,135,0)">self</span>.station_registry: Dict[<span style="color: rgb(0,135,0)">str</span>, StationDefinition] = {
<span class="ansi-green-fg">     88</span>     s.name: s <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> s <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> (<span style="color: rgb(0,135,0)">self</span>.config.stations <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> [])
<span class="ansi-green-fg">     89</span> }

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/pydantic/main.py:250</span>, in <span class="ansi-cyan-fg">BaseModel.__init__</span><span class="ansi-blue-fg">(self, **data)</span>
<span class="ansi-green-fg">    248</span> <span style="color: rgb(95,135,135)"># `__tracebackhide__` tells pytest and some other tools to omit this function from tracebacks</span>
<span class="ansi-green-fg">    249</span> __tracebackhide__ = <span class="ansi-bold" style="color: rgb(0,135,0)">True</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">250</span> validated_self = <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">__pydantic_validator__</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">validate_python</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">self_instance</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    251</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">self</span> <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> validated_self:
<span class="ansi-green-fg">    252</span>     warnings.warn(
<span class="ansi-green-fg">    253</span>         <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">A custom validator is returning a value other than `self`.</span><span class="ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg">&#39;</span>
<span class="ansi-green-fg">    254</span>         <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Returning anything other than `self` from a top level model validator isn</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">t supported when validating via `__init__`.</span><span class="ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">    255</span>         <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">See the `model_validator` docs (https://docs.pydantic.dev/latest/concepts/validators/#model-validators) for more details.</span><span class="ansi-yellow-fg">&#39;</span>,
<span class="ansi-green-fg">    256</span>         stacklevel=<span class="ansi-green-fg">2</span>,
<span class="ansi-green-fg">    257</span>     )

<span class="ansi-red-fg">ValidationError</span>: 12 validation errors for CruiseConfig
departure_port.str
  Input should be a valid string [type=string_type, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
departure_port.PortDefinition.latitude
  Field required [type=missing, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
departure_port.PortDefinition.longitude
  Field required [type=missing, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
arrival_port.str
  Input should be a valid string [type=string_type, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
arrival_port.PortDefinition.latitude
  Field required [type=missing, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
arrival_port.PortDefinition.longitude
  Field required [type=missing, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
legs.0.departure_port
  Field required [type=missing, input_value={&#39;name&#39;: &#39;Outbound_Survey...&#39;: [&#39;Demo_CTD_Section&#39;]}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
legs.0.arrival_port
  Field required [type=missing, input_value={&#39;name&#39;: &#39;Outbound_Survey...&#39;: [&#39;Demo_CTD_Section&#39;]}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
legs.1.departure_port
  Field required [type=missing, input_value={&#39;name&#39;: &#39;Return_Survey&#39;,...&#39;sequence&#39;: [&#39;STN_006&#39;]}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
legs.1.arrival_port
  Field required [type=missing, input_value={&#39;name&#39;: &#39;Return_Survey&#39;,...&#39;sequence&#39;: [&#39;STN_006&#39;]}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
first_station
  Extra inputs are not permitted [type=extra_forbidden, input_value=&#39;STN_001&#39;, input_type=str]
    For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden
last_station
  Extra inputs are not permitted [type=extra_forbidden, input_value=&#39;STN_006&#39;, input_type=str]
    For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden
</pre></div></div>
</div>
</section>
<section id="Step-6:-Enrich-Configuration">
<h2>Step 6: Enrich Configuration<a class="headerlink" href="#Step-6:-Enrich-Configuration" title="Link to this heading">ÔÉÅ</a></h2>
<p><strong>CLI Equivalent</strong>: <code class="docutils literal notranslate"><span class="pre">cruiseplan</span> <span class="pre">enrich</span> <span class="pre">-c</span> <span class="pre">demo_cruise.yaml</span> <span class="pre">--add-depths</span> <span class="pre">--add-coords</span> <span class="pre">--expand-sections</span></code></p>
<p>Add computed data like depths, formatted coordinates, and expand CTD sections.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üîß Enriching configuration...&quot;</span><span class="p">)</span>

<span class="n">config_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;demo_cruise.yaml&quot;</span>
<span class="n">enriched_config_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;demo_cruise_enriched.yaml&quot;</span>

<span class="c1"># Use the actual enrichment function</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">enrich_configuration</span><span class="p">(</span>
    <span class="n">config_path</span><span class="o">=</span><span class="n">config_file</span><span class="p">,</span>
    <span class="n">add_depths</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">add_coords</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">expand_sections</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">bathymetry_source</span><span class="o">=</span><span class="s2">&quot;etopo2022&quot;</span><span class="p">,</span>
    <span class="n">coord_format</span><span class="o">=</span><span class="s2">&quot;dmm&quot;</span><span class="p">,</span>
    <span class="n">output_path</span><span class="o">=</span><span class="n">enriched_config_file</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ Configuration enriched and saved to </span><span class="si">{</span><span class="n">enriched_config_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">summary</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sections_expanded&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Expanded </span><span class="si">{</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;sections_expanded&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> CTD sections&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Created </span><span class="si">{</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;stations_from_expansion&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> new stations&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stations_with_depths_added&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Added depths to </span><span class="si">{</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;stations_with_depths_added&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> stations&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stations_with_coords_added&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Added coordinates to </span><span class="si">{</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;stations_with_coords_added&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> stations&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING: ‚ö†Ô∏è Added missing field: default_distance_between_stations = 15.0 km
INFO: ‚ÑπÔ∏è Missing required fields added with defaults. Update these values as needed.
INFO: Expanded &#39;Demo_CTD_Section&#39; into 32 stations
INFO: Saved configuration to: /tmp/tmpoed44_6p.yaml
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
üîß Enriching configuration...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValidationError</span>                           Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[7]</span><span class="ansi-green-fg">, line 7</span>
<span class="ansi-green-fg">      4</span> enriched_config_file = output_dir / <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">demo_cruise_enriched.yaml</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">      6</span> <span style="color: rgb(95,135,135)"># Use the actual enrichment function</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">7</span> summary = <span class="ansi-yellow-bg">enrich_configuration</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">      8</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">config_path</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">config_file</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      9</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">add_depths</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">True</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     10</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">add_coords</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">True</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     11</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">expand_sections</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">True</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     12</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">bathymetry_source</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg">etopo2022</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     13</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">coord_format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg">dmm</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">     14</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">output_path</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">enriched_config_file</span>
<span class="ansi-green-fg">     15</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">     17</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">‚úÖ Configuration enriched and saved to </span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>enriched_config_file<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">     18</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> summary:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/work/cruiseplan/cruiseplan/cruiseplan/core/validation.py:2623</span>, in <span class="ansi-cyan-fg">enrich_configuration</span><span class="ansi-blue-fg">(config_path, add_depths, add_coords, expand_sections, expand_ports, bathymetry_source, bathymetry_dir, coord_format, output_path)</span>
<span class="ansi-green-fg">   2621</span>     save_yaml(config_dict, temp_config_path, backup=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>)
<span class="ansi-green-fg">   2622</span>     <span style="color: rgb(95,135,135)"># Load cruise configuration from preprocessed data</span>
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2623</span>     cruise = <span class="ansi-yellow-bg">Cruise</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">temp_config_path</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   2624</span> <span class="ansi-bold" style="color: rgb(0,135,0)">finally</span>:
<span class="ansi-green-fg">   2625</span>     <span style="color: rgb(95,135,135)"># Clean up temporary file safely</span>
<span class="ansi-green-fg">   2626</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> temp_config_path.exists():

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/work/cruiseplan/cruiseplan/cruiseplan/core/cruise.py:84</span>, in <span class="ansi-cyan-fg">Cruise.__init__</span><span class="ansi-blue-fg">(self, config_path)</span>
<span class="ansi-green-fg">     81</span> <span style="color: rgb(0,135,0)">self</span>.raw_data = <span style="color: rgb(0,135,0)">self</span>._load_yaml()
<span class="ansi-green-fg">     83</span> <span style="color: rgb(95,135,135)"># 1. Validation Pass (Pydantic)</span>
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">84</span> <span style="color: rgb(0,135,0)">self</span>.config = <span class="ansi-yellow-bg">CruiseConfig</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">raw_data</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">     86</span> <span style="color: rgb(95,135,135)"># 2. Indexing Pass (Build the Catalog Registry)</span>
<span class="ansi-green-fg">     87</span> <span style="color: rgb(0,135,0)">self</span>.station_registry: Dict[<span style="color: rgb(0,135,0)">str</span>, StationDefinition] = {
<span class="ansi-green-fg">     88</span>     s.name: s <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> s <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> (<span style="color: rgb(0,135,0)">self</span>.config.stations <span class="ansi-bold" style="color: rgb(175,0,255)">or</span> [])
<span class="ansi-green-fg">     89</span> }

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/pydantic/main.py:250</span>, in <span class="ansi-cyan-fg">BaseModel.__init__</span><span class="ansi-blue-fg">(self, **data)</span>
<span class="ansi-green-fg">    248</span> <span style="color: rgb(95,135,135)"># `__tracebackhide__` tells pytest and some other tools to omit this function from tracebacks</span>
<span class="ansi-green-fg">    249</span> __tracebackhide__ = <span class="ansi-bold" style="color: rgb(0,135,0)">True</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">250</span> validated_self = <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">__pydantic_validator__</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">validate_python</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">self_instance</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    251</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">self</span> <span class="ansi-bold" style="color: rgb(175,0,255)">is</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> validated_self:
<span class="ansi-green-fg">    252</span>     warnings.warn(
<span class="ansi-green-fg">    253</span>         <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">A custom validator is returning a value other than `self`.</span><span class="ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg">&#39;</span>
<span class="ansi-green-fg">    254</span>         <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Returning anything other than `self` from a top level model validator isn</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">t supported when validating via `__init__`.</span><span class="ansi-bold" style="color: rgb(175,95,0)">\n</span><span class="ansi-yellow-fg">&#34;</span>
<span class="ansi-green-fg">    255</span>         <span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">See the `model_validator` docs (https://docs.pydantic.dev/latest/concepts/validators/#model-validators) for more details.</span><span class="ansi-yellow-fg">&#39;</span>,
<span class="ansi-green-fg">    256</span>         stacklevel=<span class="ansi-green-fg">2</span>,
<span class="ansi-green-fg">    257</span>     )

<span class="ansi-red-fg">ValidationError</span>: 12 validation errors for CruiseConfig
departure_port.str
  Input should be a valid string [type=string_type, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
departure_port.PortDefinition.latitude
  Field required [type=missing, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
departure_port.PortDefinition.longitude
  Field required [type=missing, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
arrival_port.str
  Input should be a valid string [type=string_type, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/string_type
arrival_port.PortDefinition.latitude
  Field required [type=missing, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
arrival_port.PortDefinition.longitude
  Field required [type=missing, input_value={&#39;name&#39;: &#39;St. Johns&#39;, &#39;po... &#39;longitude&#39;: -52.7126}}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
legs.0.departure_port
  Field required [type=missing, input_value={&#39;name&#39;: &#39;Outbound_Survey...&#39;: [&#39;Demo_CTD_Section&#39;]}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
legs.0.arrival_port
  Field required [type=missing, input_value={&#39;name&#39;: &#39;Outbound_Survey...&#39;: [&#39;Demo_CTD_Section&#39;]}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
legs.1.departure_port
  Field required [type=missing, input_value={&#39;name&#39;: &#39;Return_Survey&#39;,...&#39;sequence&#39;: [&#39;STN_006&#39;]}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
legs.1.arrival_port
  Field required [type=missing, input_value={&#39;name&#39;: &#39;Return_Survey&#39;,...&#39;sequence&#39;: [&#39;STN_006&#39;]}, input_type=CommentedMap]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
first_station
  Extra inputs are not permitted [type=extra_forbidden, input_value=&#39;STN_001&#39;, input_type=str]
    For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden
last_station
  Extra inputs are not permitted [type=extra_forbidden, input_value=&#39;STN_006&#39;, input_type=str]
    For further information visit https://errors.pydantic.dev/2.12/v/extra_forbidden
</pre></div></div>
</div>
</section>
<section id="Step-7:-Generate-Maps">
<h2>Step 7: Generate Maps<a class="headerlink" href="#Step-7:-Generate-Maps" title="Link to this heading">ÔÉÅ</a></h2>
<p><strong>CLI Equivalent</strong>: <code class="docutils literal notranslate"><span class="pre">cruiseplan</span> <span class="pre">map</span> <span class="pre">-c</span> <span class="pre">demo_cruise_enriched.yaml</span> <span class="pre">--output-file</span> <span class="pre">demo_map.png</span></code></p>
<p>Create visualization maps of the cruise plan.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üó∫Ô∏è Generating cruise track map with bathymetry...&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Load the enriched cruise configuration</span>
    <span class="n">enriched_config_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;demo_cruise_enriched.yaml&quot;</span>
    <span class="n">cruise</span> <span class="o">=</span> <span class="n">Cruise</span><span class="p">(</span><span class="n">enriched_config_file</span><span class="p">)</span>

    <span class="c1"># Generate the map using the new function</span>
    <span class="n">map_file</span> <span class="o">=</span> <span class="n">generate_map_from_yaml</span><span class="p">(</span>
        <span class="n">cruise</span><span class="p">,</span>
        <span class="n">output_file</span><span class="o">=</span><span class="s2">&quot;demo_cruise_map.png&quot;</span><span class="p">,</span>
        <span class="n">bathymetry_source</span><span class="o">=</span><span class="s2">&quot;gebco2025&quot;</span><span class="p">,</span>
        <span class="n">bathymetry_stride</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Display inline in notebook</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">map_file</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Map generated and displayed&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ùå Map generation failed&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Map generation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
üó∫Ô∏è Generating cruise track map with bathymetry...
‚ùå Map generation failed: YAML file not found: ../tests_output/demo/demo_cruise_enriched.yaml
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Traceback (most recent call last):
  File &#34;/tmp/ipykernel_2636/1156403205.py&#34;, line 6, in &lt;module&gt;
    cruise = Cruise(enriched_config_file)
  File &#34;/home/runner/work/cruiseplan/cruiseplan/cruiseplan/core/cruise.py&#34;, line 81, in __init__
    self.raw_data = self._load_yaml()
                    ~~~~~~~~~~~~~~~^^
  File &#34;/home/runner/work/cruiseplan/cruiseplan/cruiseplan/core/cruise.py&#34;, line 125, in _load_yaml
    return load_yaml(self.config_path)
  File &#34;/home/runner/work/cruiseplan/cruiseplan/cruiseplan/utils/yaml_io.py&#34;, line 69, in load_yaml
    raise YAMLIOError(f&#34;YAML file not found: {file_path}&#34;)
cruiseplan.utils.yaml_io.YAMLIOError: YAML file not found: ../tests_output/demo/demo_cruise_enriched.yaml
</pre></div></div>
</div>
</section>
<section id="Step-8:-Generate-Schedule">
<h2>Step 8: Generate Schedule<a class="headerlink" href="#Step-8:-Generate-Schedule" title="Link to this heading">ÔÉÅ</a></h2>
<p><strong>CLI Equivalent</strong>: <code class="docutils literal notranslate"><span class="pre">cruiseplan</span> <span class="pre">schedule</span> <span class="pre">-c</span> <span class="pre">demo_cruise_enriched.yaml</span> <span class="pre">-o</span> <span class="pre">tests_output/demo/</span> <span class="pre">--format</span> <span class="pre">all</span></code></p>
<p>Generate the complete cruise timeline and output files.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üìÖ Generating cruise schedule...&quot;</span><span class="p">)</span>

<span class="c1"># Generate the schedule with multiple output formats</span>
<span class="n">schedule_results</span> <span class="o">=</span> <span class="n">generate_cruise_schedule</span><span class="p">(</span>
    <span class="n">config_path</span><span class="o">=</span><span class="n">enriched_config_file</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
    <span class="n">formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;csv&quot;</span><span class="p">,</span><span class="s2">&quot;netcdf&quot;</span><span class="p">],</span>  <span class="c1"># Available formats: html, csv, latex, netcdf, kml, png</span>
    <span class="n">validate_depths</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">selected_leg</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Schedule generated successfully!&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">schedule_results</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">format_type</span><span class="p">,</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">schedule_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - </span><span class="si">{</span><span class="n">format_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
üìÖ Generating cruise schedule...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">YAMLIOError</span>                               Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[9]</span><span class="ansi-green-fg">, line 4</span>
<span class="ansi-green-fg">      1</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">üìÖ Generating cruise schedule...</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">      3</span> <span style="color: rgb(95,135,135)"># Generate the schedule with multiple output formats</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">4</span> schedule_results = <span class="ansi-yellow-bg">generate_cruise_schedule</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">      5</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">config_path</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">enriched_config_file</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      6</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">output_dir</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">output_dir</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      7</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">formats</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg">html</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg">csv</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-fg ansi-yellow-bg">netcdf</span><span class="ansi-yellow-fg ansi-yellow-bg">&#34;</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg">  </span><span class="ansi-yellow-bg" style="color: rgb(95,135,135)"># Available formats: html, csv, latex, netcdf, kml, png</span>
<span class="ansi-green-fg">      8</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">validate_depths</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">      9</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">selected_leg</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">None</span>
<span class="ansi-green-fg">     10</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">     12</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">‚úÖ Schedule generated successfully!</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">     13</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> schedule_results:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/work/cruiseplan/cruiseplan/cruiseplan/calculators/scheduler.py:1353</span>, in <span class="ansi-cyan-fg">generate_cruise_schedule</span><span class="ansi-blue-fg">(config_path, output_dir, formats, validate_depths, selected_leg, derive_netcdf)</span>
<span class="ansi-green-fg">   1350</span>     formats = [<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">html</span><span class="ansi-yellow-fg">&#34;</span>, <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">csv</span><span class="ansi-yellow-fg">&#34;</span>]
<span class="ansi-green-fg">   1352</span> <span style="color: rgb(95,135,135)"># Load cruise configuration</span>
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">1353</span> cruise = <span class="ansi-yellow-bg">Cruise</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">config_path</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">   1354</span> config = cruise.config
<span class="ansi-green-fg">   1356</span> logger.info(<span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Loaded cruise: </span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>config.cruise_name<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/work/cruiseplan/cruiseplan/cruiseplan/core/cruise.py:81</span>, in <span class="ansi-cyan-fg">Cruise.__init__</span><span class="ansi-blue-fg">(self, config_path)</span>
<span class="ansi-green-fg">     56</span> <span class="ansi-yellow-fg">&#34;&#34;&#34;</span>
<span class="ansi-green-fg">     57</span> <span class="ansi-yellow-fg">Initialize a Cruise object from a YAML configuration file.</span>
<span class="ansi-green-fg">     58</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">     78</span> <span class="ansi-yellow-fg">    If referenced stations or transits are not found in the catalog.</span>
<span class="ansi-green-fg">     79</span> <span class="ansi-yellow-fg">&#34;&#34;&#34;</span>
<span class="ansi-green-fg">     80</span> <span style="color: rgb(0,135,0)">self</span>.config_path = Path(config_path)
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">81</span> <span style="color: rgb(0,135,0)">self</span>.raw_data = <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_load_yaml</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">     83</span> <span style="color: rgb(95,135,135)"># 1. Validation Pass (Pydantic)</span>
<span class="ansi-green-fg">     84</span> <span style="color: rgb(0,135,0)">self</span>.config = CruiseConfig(**<span style="color: rgb(0,135,0)">self</span>.raw_data)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/work/cruiseplan/cruiseplan/cruiseplan/core/cruise.py:125</span>, in <span class="ansi-cyan-fg">Cruise._load_yaml</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg">    109</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-fg">_load_yaml</span>(<span style="color: rgb(0,135,0)">self</span>) -&gt; Dict[<span style="color: rgb(0,135,0)">str</span>, Any]:
<span class="ansi-green-fg">    110</span> <span style="color: rgb(188,188,188)">    </span><span class="ansi-yellow-fg">&#34;&#34;&#34;</span>
<span class="ansi-green-fg">    111</span> <span class="ansi-yellow-fg">    Load and parse the YAML configuration file.</span>
<span class="ansi-green-fg">    112</span>
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    123</span> <span class="ansi-yellow-fg">        If the YAML file cannot be parsed.</span>
<span class="ansi-green-fg">    124</span> <span class="ansi-yellow-fg">    &#34;&#34;&#34;</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">125</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">load_yaml</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">config_path</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/work/cruiseplan/cruiseplan/cruiseplan/utils/yaml_io.py:69</span>, in <span class="ansi-cyan-fg">load_yaml</span><span class="ansi-blue-fg">(file_path, encoding)</span>
<span class="ansi-green-fg">     66</span> file_path = Path(file_path)
<span class="ansi-green-fg">     68</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> file_path.exists():
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">69</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> YAMLIOError(<span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">YAML file not found: </span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>file_path<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span class="ansi-yellow-fg">&#34;</span>)
<span class="ansi-green-fg">     71</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span class="ansi-bold" style="color: rgb(175,0,255)">not</span> file_path.is_file():
<span class="ansi-green-fg">     72</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> YAMLIOError(<span class="ansi-yellow-fg">f</span><span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">Path is not a file: </span><span class="ansi-bold" style="color: rgb(175,95,135)">{</span>file_path<span class="ansi-bold" style="color: rgb(175,95,135)">}</span><span class="ansi-yellow-fg">&#34;</span>)

<span class="ansi-red-fg">YAMLIOError</span>: YAML file not found: ../tests_output/demo/demo_cruise_enriched.yaml
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;Demo_North_Atlantic_Survey_2025_schedule.nc&#39;</span><span class="p">)</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/xarray/backends/file_manager.py:219</span>, in <span class="ansi-cyan-fg">CachingFileManager._acquire_with_cache_info</span><span class="ansi-blue-fg">(self, needs_lock)</span>
<span class="ansi-green-fg">    218</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">219</span>     file = <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_cache</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_key</span><span class="ansi-yellow-bg">]</span>
<span class="ansi-green-fg">    220</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">KeyError</span>:

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/xarray/backends/lru_cache.py:56</span>, in <span class="ansi-cyan-fg">LRUCache.__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-fg">     55</span> <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> <span style="color: rgb(0,135,0)">self</span>._lock:
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">56</span>     value = <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_cache</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">key</span><span class="ansi-yellow-bg">]</span>
<span class="ansi-green-fg">     57</span>     <span style="color: rgb(0,135,0)">self</span>._cache.move_to_end(key)

<span class="ansi-red-fg">KeyError</span>: [&lt;class &#39;netCDF4._netCDF4.Dataset&#39;&gt;, (&#39;/home/runner/work/cruiseplan/cruiseplan/tests_output/demo/Demo_North_Atlantic_Survey_2025_schedule.nc&#39;,), &#39;r&#39;, ((&#39;clobber&#39;, True), (&#39;diskless&#39;, False), (&#39;format&#39;, &#39;NETCDF4&#39;), (&#39;persist&#39;, False)), &#39;4d4b6d1c-4382-469f-8959-54a17e2df5e5&#39;]

During handling of the above exception, another exception occurred:

<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[10]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> ds = <span class="ansi-yellow-bg">xr</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_dataset</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">output_dir</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">/</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-fg ansi-yellow-bg">Demo_North_Atlantic_Survey_2025_schedule.nc</span><span class="ansi-yellow-fg ansi-yellow-bg">&#39;</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">      2</span> ds

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/xarray/backends/api.py:606</span>, in <span class="ansi-cyan-fg">open_dataset</span><span class="ansi-blue-fg">(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, create_default_indexes, inline_array, chunked_array_type, from_array_kwargs, backend_kwargs, **kwargs)</span>
<span class="ansi-green-fg">    594</span> decoders = _resolve_decoders_kwargs(
<span class="ansi-green-fg">    595</span>     decode_cf,
<span class="ansi-green-fg">    596</span>     open_backend_dataset_parameters=backend.open_dataset_parameters,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    602</span>     decode_coords=decode_coords,
<span class="ansi-green-fg">    603</span> )
<span class="ansi-green-fg">    605</span> overwrite_encoded_chunks = kwargs.pop(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">overwrite_encoded_chunks</span><span class="ansi-yellow-fg">&#34;</span>, <span class="ansi-bold" style="color: rgb(0,135,0)">None</span>)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">606</span> backend_ds = <span class="ansi-yellow-bg">backend</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open_dataset</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    607</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    608</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">drop_variables</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    609</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">decoders</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    610</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    611</span> <span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    612</span> ds = _dataset_from_backend_dataset(
<span class="ansi-green-fg">    613</span>     backend_ds,
<span class="ansi-green-fg">    614</span>     filename_or_obj,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    625</span>     **kwargs,
<span class="ansi-green-fg">    626</span> )
<span class="ansi-green-fg">    627</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> ds

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/xarray/backends/netCDF4_.py:767</span>, in <span class="ansi-cyan-fg">NetCDF4BackendEntrypoint.open_dataset</span><span class="ansi-blue-fg">(self, filename_or_obj, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, use_cftime, decode_timedelta, group, mode, format, clobber, diskless, persist, auto_complex, lock, autoclose)</span>
<span class="ansi-green-fg">    745</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-fg">open_dataset</span>(
<span class="ansi-green-fg">    746</span>     <span style="color: rgb(0,135,0)">self</span>,
<span class="ansi-green-fg">    747</span>     filename_or_obj: T_PathFileOrDataStore,
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">    764</span>     autoclose=<span class="ansi-bold" style="color: rgb(0,135,0)">False</span>,
<span class="ansi-green-fg">    765</span> ) -&gt; Dataset:
<span class="ansi-green-fg">    766</span>     filename_or_obj = _normalize_path(filename_or_obj)
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">767</span>     store = <span class="ansi-yellow-bg">NetCDF4DataStore</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">open</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg">    768</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">filename_or_obj</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    769</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    770</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">format</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">format</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    771</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    772</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">clobber</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">clobber</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    773</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">diskless</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">diskless</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    774</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">persist</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">persist</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    775</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">auto_complex</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">auto_complex</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    776</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">lock</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">lock</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    777</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">autoclose</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">autoclose</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg">    778</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    780</span>     store_entrypoint = StoreBackendEntrypoint()
<span class="ansi-green-fg">    781</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">with</span> close_on_error(store):

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/xarray/backends/netCDF4_.py:525</span>, in <span class="ansi-cyan-fg">NetCDF4DataStore.open</span><span class="ansi-blue-fg">(cls, filename, mode, format, group, clobber, diskless, persist, auto_complex, lock, lock_maker, autoclose)</span>
<span class="ansi-green-fg">    521</span> <span class="ansi-bold" style="color: rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">    522</span>     manager = CachingFileManager(
<span class="ansi-green-fg">    523</span>         netCDF4.Dataset, filename, mode=mode, kwargs=kwargs
<span class="ansi-green-fg">    524</span>     )
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">525</span> <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">cls</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">manager</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">group</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">mode</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">lock</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">lock</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">autoclose</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">autoclose</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/xarray/backends/netCDF4_.py:429</span>, in <span class="ansi-cyan-fg">NetCDF4DataStore.__init__</span><span class="ansi-blue-fg">(self, manager, group, mode, lock, autoclose)</span>
<span class="ansi-green-fg">    427</span> <span style="color: rgb(0,135,0)">self</span>._group = group
<span class="ansi-green-fg">    428</span> <span style="color: rgb(0,135,0)">self</span>._mode = mode
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">429</span> <span style="color: rgb(0,135,0)">self</span>.format = <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">ds</span>.data_model
<span class="ansi-green-fg">    430</span> <span style="color: rgb(0,135,0)">self</span>._filename = <span style="color: rgb(0,135,0)">self</span>.ds.filepath()
<span class="ansi-green-fg">    431</span> <span style="color: rgb(0,135,0)">self</span>.is_remote = is_remote_uri(<span style="color: rgb(0,135,0)">self</span>._filename)

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/xarray/backends/netCDF4_.py:534</span>, in <span class="ansi-cyan-fg">NetCDF4DataStore.ds</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg">    532</span> <span style="color: rgb(175,0,255)">@property</span>
<span class="ansi-green-fg">    533</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-fg">ds</span>(<span style="color: rgb(0,135,0)">self</span>):
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">534</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_acquire</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/xarray/backends/netCDF4_.py:528</span>, in <span class="ansi-cyan-fg">NetCDF4DataStore._acquire</span><span class="ansi-blue-fg">(self, needs_lock)</span>
<span class="ansi-green-fg">    527</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-fg">_acquire</span>(<span style="color: rgb(0,135,0)">self</span>, needs_lock=<span class="ansi-bold" style="color: rgb(0,135,0)">True</span>):
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">528</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">with</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_manager</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">acquire_context</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">needs_lock</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">as</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">root</span><span class="ansi-yellow-bg">:</span>
<span class="ansi-green-fg">    529</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">ds</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">_nc4_require_group</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">root</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_group</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_mode</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    530</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> ds

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/contextlib.py:141</span>, in <span class="ansi-cyan-fg">_GeneratorContextManager.__enter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-fg">    139</span> <span class="ansi-bold" style="color: rgb(0,135,0)">del</span> <span style="color: rgb(0,135,0)">self</span>.args, <span style="color: rgb(0,135,0)">self</span>.kwds, <span style="color: rgb(0,135,0)">self</span>.func
<span class="ansi-green-fg">    140</span> <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">141</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">return</span> <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">next</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">gen</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    142</span> <span class="ansi-bold" style="color: rgb(0,135,0)">except</span> <span class="ansi-bold" style="color: rgb(215,95,95)">StopIteration</span>:
<span class="ansi-green-fg">    143</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">raise</span> <span class="ansi-bold" style="color: rgb(215,95,95)">RuntimeError</span>(<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">generator didn</span><span class="ansi-yellow-fg">&#39;</span><span class="ansi-yellow-fg">t yield</span><span class="ansi-yellow-fg">&#34;</span>) <span class="ansi-bold" style="color: rgb(0,135,0)">from</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-bold" style="color: rgb(0,135,0)">None</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/xarray/backends/file_manager.py:207</span>, in <span class="ansi-cyan-fg">CachingFileManager.acquire_context</span><span class="ansi-blue-fg">(self, needs_lock)</span>
<span class="ansi-green-fg">    204</span> <span style="color: rgb(175,0,255)">@contextmanager</span>
<span class="ansi-green-fg">    205</span> <span class="ansi-bold" style="color: rgb(0,135,0)">def</span><span style="color: rgb(188,188,188)"> </span><span class="ansi-blue-fg">acquire_context</span>(<span style="color: rgb(0,135,0)">self</span>, needs_lock: <span style="color: rgb(0,135,0)">bool</span> = <span class="ansi-bold" style="color: rgb(0,135,0)">True</span>) -&gt; Iterator[T_File]:
<span class="ansi-green-fg">    206</span> <span style="color: rgb(188,188,188)">    </span><span class="ansi-yellow-fg">&#34;&#34;&#34;Context manager for acquiring a file.&#34;&#34;&#34;</span>
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">207</span>     file, cached = <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_acquire_with_cache_info</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">needs_lock</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    208</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">    209</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">yield</span> file

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/micromamba/envs/cruiseplan/lib/python3.13/site-packages/xarray/backends/file_manager.py:225</span>, in <span class="ansi-cyan-fg">CachingFileManager._acquire_with_cache_info</span><span class="ansi-blue-fg">(self, needs_lock)</span>
<span class="ansi-green-fg">    223</span>     kwargs = kwargs.copy()
<span class="ansi-green-fg">    224</span>     kwargs[<span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">mode</span><span class="ansi-yellow-fg">&#34;</span>] = <span style="color: rgb(0,135,0)">self</span>._mode
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">225</span> file = <span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_opener</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg" style="color: rgb(0,135,0)">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">    226</span> <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> <span style="color: rgb(0,135,0)">self</span>._mode == <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">w</span><span class="ansi-yellow-fg">&#34;</span>:
<span class="ansi-green-fg">    227</span>     <span style="color: rgb(95,135,135)"># ensure file doesn&#39;t get overridden when opened again</span>
<span class="ansi-green-fg">    228</span>     <span style="color: rgb(0,135,0)">self</span>._mode = <span class="ansi-yellow-fg">&#34;</span><span class="ansi-yellow-fg">a</span><span class="ansi-yellow-fg">&#34;</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">src/netCDF4/_netCDF4.pyx:2517</span>, in <span class="ansi-cyan-fg">netCDF4._netCDF4.Dataset.__init__</span><span class="ansi-blue-fg">()</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">src/netCDF4/_netCDF4.pyx:2154</span>, in <span class="ansi-cyan-fg">netCDF4._netCDF4._ensure_nc_success</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;/home/runner/work/cruiseplan/cruiseplan/tests_output/demo/Demo_North_Atlantic_Survey_2025_schedule.nc&#39;
</pre></div></div>
</div>
</section>
<section id="Workflow-Summary">
<h2>Workflow Summary<a class="headerlink" href="#Workflow-Summary" title="Link to this heading">ÔÉÅ</a></h2>
<p>Let‚Äôs review what we‚Äôve accomplished and check our output files.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üìã CruisePlan Demo Workflow Complete!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">üóÇÔ∏è  Generated files in tests_output/demo/:&quot;</span><span class="p">)</span>

<span class="c1"># List all files in output directory using pathlib.Path</span>

<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>  <span class="c1"># Ensure output_dir is a Path object</span>
<span class="k">if</span> <span class="n">output_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">output_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">))</span>
    <span class="n">total_size</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
            <span class="n">total_size</span> <span class="o">+=</span> <span class="n">size</span>
            <span class="n">size_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">size</span><span class="o">/</span><span class="mi">1024</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">KB&quot;</span> <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">size</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">1024</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">MB&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   üìÑ </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s2">&lt;30</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">size_str</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">üíæ Total output size: </span><span class="si">{</span><span class="n">total_size</span><span class="o">/</span><span class="mi">1024</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">KB&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìÅ Output directory: </span><span class="si">{</span><span class="n">output_dir</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   No output files found&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">‚ú® Workflow Steps Completed:&quot;</span><span class="p">)</span>
<span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;1. ‚úÖ Downloaded bathymetry data (ETOPO2022)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2. ‚úÖ Searched PANGAEA database for relevant datasets&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3. ‚úÖ Processed DOI list into campaign data&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4. ‚úÖ Created station configuration programmatically&quot;</span><span class="p">,</span>
    <span class="s2">&quot;5. ‚úÖ Validated configuration and checked depths&quot;</span><span class="p">,</span>
    <span class="s2">&quot;6. ‚úÖ Enriched configuration with computed data&quot;</span><span class="p">,</span>
    <span class="s2">&quot;7. ‚úÖ Generated complete cruise schedule and timeline&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8. ‚úÖ Created interactive cruise track map&quot;</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">üéØ Next Steps:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ‚Ä¢ Review demo_cruise_schedule.html for the complete cruise timeline&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ‚Ä¢ Examine demo_cruise_enriched.yaml to see the enriched configuration&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ‚Ä¢ Import demo_cruise_schedule.nc into data analysis tools&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">üöÄ This demonstrates the complete CruisePlan workflow using Python functions!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Each step corresponds to a CLI command but uses the underlying Python API.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
üìã CruisePlan Demo Workflow Complete!

üóÇÔ∏è  Generated files in tests_output/demo/:
   üìÑ ctd_pangaea_data.pkl           (0.5KB)
   üìÑ demo_cruise.yaml               (2.3KB)
   üìÑ demo_dois.txt                  (0.1KB)

üíæ Total output size: 2.9KB
üìÅ Output directory: /home/runner/work/cruiseplan/cruiseplan/notebooks/../tests_output/demo

‚ú® Workflow Steps Completed:
   1. ‚úÖ Downloaded bathymetry data (ETOPO2022)
   2. ‚úÖ Searched PANGAEA database for relevant datasets
   3. ‚úÖ Processed DOI list into campaign data
   4. ‚úÖ Created station configuration programmatically
   5. ‚úÖ Validated configuration and checked depths
   6. ‚úÖ Enriched configuration with computed data
   7. ‚úÖ Generated complete cruise schedule and timeline
   8. ‚úÖ Created interactive cruise track map

üéØ Next Steps:
   ‚Ä¢ Review demo_cruise_schedule.html for the complete cruise timeline
   ‚Ä¢ Examine demo_cruise_enriched.yaml to see the enriched configuration
   ‚Ä¢ Import demo_cruise_schedule.nc into data analysis tools

üöÄ This demonstrates the complete CruisePlan workflow using Python functions!
   Each step corresponds to a CLI command but uses the underlying Python API.
</pre></div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="user_workflows.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cli_reference.html" class="btn btn-neutral float-right" title="CLI Command Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>